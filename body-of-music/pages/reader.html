<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>View Post</title>
  <script src="../components/blog-navbar.js"></script>
  <script src="../components/markdown-reader.js"></script>
  <link rel="stylesheet" href="../styles/styles.css">
  <!-- easyMDE -->
  <link rel="stylesheet" href="../../lib/easymde.min.css">
  <script src="../../lib/marked.min.js"></script>
</head>
<body>
  <blog-navbar title="Posts Index">
    <button id="leftButton" slot="left-button">
      Left
    </button>
    <button id="rightButton" slot="right-button">
      Right
    </button>
  </blog-navbar>
  <div class="container">
    <h1>Post Reader</h1>
    <div style="margin-top:2em; display:flex; justify-content:space-between;">
      <button id="prevBtn">Previous</button>
      <button id="nextBtn">Next</button>
    </div>
    <markdown-reader id="mdReader"></markdown-reader>
  </div>
  <script>
    // Get the 'file' query parameter from the URL
    function getQueryParam(name) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(name);
    }
    fetch('blogs-index.csv')
      .then(response => response.text())
      .then(text => {
        const lines = text.trim().split('\n').slice(1);
        if (lines.length < 2) {
          this.shadowRoot.querySelector('.posts-index').innerHTML = '<p>No posts available.</p>';
          return;
        }
        const posts = (
          lines
          .map(post => {
            const [title, filename, date] = post.split(',');
            return filename.trim();
          })
          .filter(Boolean)
          .filter(filename => filename.endsWith('.md'))
        );
        const file = getQueryParam('file');
        let currentIndex = posts.indexOf(file);
        if (file && currentIndex !== -1) {
          document.getElementById('mdReader').setAttribute('src', `../posts/${file}`);
        } else {
          document.getElementById('mdReader').setAttribute('markdown', 'No file specified.');
          currentIndex = 0;
        }
        function navigate(offset) {
          currentIndex = (currentIndex + offset + posts.length) % posts.length;
          window.location.search = '?file=' + encodeURIComponent(posts[currentIndex]);
        }
        document.getElementById('prevBtn').onclick = () => navigate(-1);
        document.getElementById('nextBtn').onclick = () => navigate(1);
      });
  </script>
</body>
</html>