<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>View Post</title>
  <!-- Use the marked.js library for markdown parsing -->
  <link rel="stylesheet" href="../../lib/easymde.min.css">
  <script src="../../lib/marked.min.js"></script>
  <script src="../components/markdown-viewer.js"></script>
  <style>
    body { font-family: sans-serif; background: #f9f9f9; margin: 2em; }
    .container { max-width: 700px; margin: auto; background: #fff; padding: 2em; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    h1, h2, h3 { color: #333; }
    pre, code { background: #eee; border-radius: 4px; padding: 0.2em 0.4em; }
    a { color: #007acc; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Post Viewer</h1>
    <div style="margin-top:2em; display:flex; justify-content:space-between;">
      <button id="prevBtn">Previous</button>
      <button id="nextBtn">Next</button>
    </div>
    <markdown-viewer id="mdViewer"></markdown-viewer>
  </div>
  <script>
    // Get the 'file' query parameter from the URL
    function getQueryParam(name) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(name);
    }
    fetch('index.md')
      .then(response => response.text())
      .then(text => {
        const posts = text.split('\n')
          .map(line => {
            const regex = /\[([^\]]+)\]\(([^)]+)\)/;
            const match = line.match(regex);
            if (match) {
              const title = match[1];
              const file = match[2];
              return file.trim();
            }
            return line.trim();
          })
          .filter(line => line.endsWith('.md'));
        const file = getQueryParam('file');
        let currentIndex = posts.indexOf(file);
        if (file && currentIndex !== -1) {
          document.getElementById('mdViewer').setAttribute('src', file);
        } else {
          document.getElementById('mdViewer').setAttribute('markdown', 'No file specified.');
          currentIndex = 0;
        }
        function navigate(offset) {
          currentIndex = (currentIndex + offset + posts.length) % posts.length;
          window.location.search = '?file=' + encodeURIComponent(posts[currentIndex]);
        }
        document.getElementById('prevBtn').onclick = () => navigate(-1);
        document.getElementById('nextBtn').onclick = () => navigate(1);
      });
  </script>
</body>
</html>